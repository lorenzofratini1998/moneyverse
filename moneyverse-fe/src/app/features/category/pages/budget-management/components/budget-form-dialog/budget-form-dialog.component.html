<p-dialog
  [modal]="true"
  [resizable]="false"
  [draggable]="false"
  [(visible)]="_isOpen"
  (onHide)="close()"
>
  <ng-template #header>
    <h3 class="font-bold text-lg">
      @if (_budgetToEdit()) {
        Edit Budget
      } @else {
        Add Budget
      }
    </h3>
  </ng-template>

  <ng-template #content>
    <form [formGroup]="budgetForm">
      <div class="flex flex-col gap-4 py-2">
        <div class="flex gap-4">
          <div class="flex flex-col w-full gap-1">
            <p-float-label variant="on">
              <p-date-picker formControlName="rangeDates"
                             id="rangeDates"
                             selectionMode="range"
                             [readonlyInput]="true"
                             [showIcon]="true"
                             [appendTo]="'body'"
                             dateFormat="dd/mm/yy"
              />
              <label for="rangeDates">Period</label>
            </p-float-label>
            @if (isInvalid('rangeDates')) {
              <p-message severity="error" size="small" variant="simple">Period is required.</p-message>
            }
          </div>
          <div class="flex flex-col w-full gap-1">
            <p-float-label variant="on">
              <p-input-number id="budgetLimit"
                              formControlName="budgetLimit"
                              mode="currency"
                              [currency]="budgetForm.get('currency')?.value"
                              [locale]="languageService.getCurrentLanguage().replace('_', '-')"
                              class="w-full"
              />
              <label for="budgetLimit">Budget Limit</label>
            </p-float-label>
            @if (isInvalid('budgetLimit')) {
              <p-message severity="error" size="small" variant="simple">Budget limit is required.</p-message>
            }
          </div>
          @if (_budgetToEdit()) {
            <p-float-label variant="on">
              <p-input-number id="amount"
                              formControlName="amount"
                              mode="currency"
                              [currency]="budgetForm.get('currency')?.value"
                              [locale]="languageService.getCurrentLanguage().replace('_', '-')"
                              class="w-full"
              />
              <label for="amount">Amount</label>
            </p-float-label>
          }
        </div>
        <div class="flex gap-4">
          <div class="flex flex-col w-full gap-1">
            <p-float-label variant="on">
              <p-select id="category"
                        formControlName="category"
                        [options]="categoryStore.categories()"
                        optionLabel="categoryName"
                        optionValue="categoryId"
                        [appendTo]="'body'"
                        class="w-full"
              />
              <label for="category">Category</label>
            </p-float-label>
            @if (isInvalid('category')) {
              <p-message severity="error" size="small" variant="simple">Category is required.</p-message>
            }
          </div>
          <div class="flex flex-col w-full gap-1">
            <p-float-label variant="on">
              <p-select id="currency"
                        formControlName="currency"
                        [options]="currencyStore.currencies()"
                        optionValue="code"
                        [appendTo]="'body'"
                        class="w-full"
              >
                <ng-template #selectedItem let-currency>
              <span class="flex items-center">
                {{ currency.name }} ({{ currency.code }})
              </span>
                </ng-template>
                <ng-template let-currency #item>
              <span class="flex items-center">
                {{ currency.name }} ({{ currency.code }})
              </span>
                </ng-template>
              </p-select>
              <label for="currency">Currency</label>
            </p-float-label>
            @if (isInvalid('currency')) {
              <p-message severity="error" size="small" variant="simple">Currency is required.</p-message>
            }
          </div>
        </div>
      </div>
    </form>
  </ng-template>

  <ng-template #footer>
    <div class="flex justify-center gap-2 w-full">
      <p-button (onClick)="cancel()"
                [rounded]="true"
                [outlined]="true"
                severity="secondary"
      >
        <app-svg [name]="Icons.X"/>
        <span>Cancel</span>
      </p-button>
      <p-button (onClick)="saveBudget()"
                [rounded]="true"
                severity="contrast"
                type="submit"
      >
        <app-svg [name]="Icons.CHECK"/>
        <span>Save</span>
      </p-button>
    </div>
  </ng-template>
</p-dialog>
