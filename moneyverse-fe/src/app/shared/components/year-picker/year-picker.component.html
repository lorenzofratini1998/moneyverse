<div class="dropdown dropdown-end">
  <div
    tabindex="0"
    role="button"
    class="btn btn-outline btn-primary gap-2 min-w-32"
    [class.btn-active]="isOpen()"
  >
    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
    </svg>
    {{ selectedYear() || placeholder }}
    <svg class="w-4 h-4 transition-transform" [class.rotate-180]="isOpen()" xmlns="http://www.w3.org/2000/svg"
         fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
    </svg>
  </div>

  <div
    tabindex="0"
    class="dropdown-content z-[1] card card-compact w-64 p-4 shadow-xl bg-base-100 border border-base-300"
    (click)="$event.stopPropagation()"
  >
    <!-- Navigation Header -->
    <div class="flex items-center justify-between mb-4">
      <button
        class="btn btn-sm btn-circle btn-ghost"
        (click)="navigateDecade(-1)"
        [disabled]="currentDecadeStart() <= minYear"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>

      <span class="text-sm font-semibold">
            {{ currentDecadeStart() }} - {{ currentDecadeEnd() }}
          </span>

      <button
        class="btn btn-sm btn-circle btn-ghost"
        (click)="navigateDecade(1)"
        [disabled]="currentDecadeEnd() >= maxYear"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>
    </div>

    <!-- Years Grid -->
    <div class="grid grid-cols-3 gap-2">
      @for (year of displayedYears(); track year) {
        <button
          class="btn btn-sm h-10 transition-all duration-200"
          [class]="getYearButtonClass(year)"
          [disabled]="isYearDisabled(year)"
          (click)="selectYear(year)"
        >
          {{ year }}
        </button>
      }
    </div>

    <!-- Quick Actions -->
    <div class="mt-4 pt-3 border-t border-base-200">
      <div class="flex gap-2">
        <button
          class="btn btn-xs btn-ghost flex-1"
          (click)="selectYear(currentYear)"
          [disabled]="isYearDisabled(currentYear)"
        >
          Oggi ({{ currentYear }})
        </button>
        @if (selectedYear()) {
          <button
            class="btn btn-xs btn-ghost"
            (click)="clearSelection()"
          >
            Cancella
          </button>
        }
      </div>
    </div>
  </div>
</div>
